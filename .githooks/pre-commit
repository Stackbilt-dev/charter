#!/usr/bin/env bash
set -euo pipefail

echo '[pre-commit] Running TypeScript check (pnpm exec tsc --noEmit)...'
pnpm exec tsc --noEmit

# ADF evidence gate: check LOC ceilings if manifest exists
if [ -f ".ai/manifest.adf" ]; then
  echo '[pre-commit] Running ADF evidence check (LOC ceilings)...'
  node packages/cli/dist/bin.js adf evidence --auto-measure --ci 2>/dev/null || {
    echo ''
    echo '[pre-commit] ADF evidence FAILED â€” LOC ceiling breached.'
    echo '  Run: node packages/cli/dist/bin.js adf evidence --auto-measure'
    echo '  to see which files exceed their ceilings.'
    exit 1
  }
fi
